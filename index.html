<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Drop URL ‚Üí Blob:</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto;display:flex;align-items:center;justify-content:center;height:100vh;background:#0f172a;color:#e6eef8}
    .card{background:#111827;padding:24px;border-radius:12px;max-width:640px;width:100%}
    input{width:100%;padding:10px;margin-bottom:8px;border-radius:6px;border:1px solid #334155;background:#0b1220;color:#e6eef8}
    button{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;background:#1e293b;color:white}
    a.blob{display:block;margin-top:12px;color:#60a5fa;word-break:break-all}
    small{color:#94a3b8}
  </style>
</head>
<body>
  <div class="card">
    <h2>–í—Å—Ç–∞–≤—å URL ‚Üí –ü–æ–ª—É—á–∏ blob:</h2>
    <small>Insert any public URL (image, file, etc.)</small>
    <input id="url" placeholder="https://example.com/img.png" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="go">Convert</button>
      <button id="paste">Paste</button>
    </div>
    <div id="out" style="margin-top:12px"></div>
  </div>

<script>
document.getElementById('paste').addEventListener('click', async () => {
  const text = await navigator.clipboard.readText().catch(()=>'' );
  document.getElementById('url').value = text;
});

document.getElementById('go').addEventListener('click', async () => {
  const u = document.getElementById('url').value.trim();
  const out = document.getElementById('out');

  if (!u) {
    out.innerHTML = "<div style='color:#fca5a5'>No URL</div>";
    return;
  }

  out.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶';

  try {
    const r = await fetch('/api/upload', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ url: u })
    });

    const j = await r.json();
    if (!r.ok) throw j;

    // decode Base64 ‚Üí Blob
    const bytes = Uint8Array.from(atob(j.data), c => c.charCodeAt(0));
    const blob = new Blob([bytes], { type: j.mime });

    // real browser blob: URL
    const blobUrl = URL.createObjectURL(blob);

    out.innerHTML = `
      <div>–ì–æ—Ç–æ–≤–æ! üì¶</div>
      <a class="blob" href="${blobUrl}" target="_blank">${blobUrl}</a>
    `;
  } catch (e) {
    out.innerHTML = '<div style="color:#fca5a5">Error: ' 
      + (e.error || e.message || JSON.stringify(e)) + '</div>';
  }
});
</script>
</body>
</html>
